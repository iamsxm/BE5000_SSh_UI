name: build-go-binary

on:
  push:
    branches:
      - main
#on:
#  release:
#    types: [created] # 表示在创建新的 Release 时触发
permissions:
  contents: write
  packages: write

jobs:
  build-go-binary:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        goos: [windows] # 需要打包的系统
        goarch: [amd64] # 需要打包的架构
    steps:
      - uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.23'

      - name: install dependencies
        run: |
          sudo apt-get install gcc-mingw-w64
          sudo apt install xorg-dev
          go install fyne.io/fyne/v2/cmd/fyne@latest

      - name: download icon
        run: |
          curl -L https://raw.githubusercontent.com/iamsxm/BE5000_SSh_UI/master/xiaomi_icon.png > Icon.png

      - name: build release
        run: |
          export CC=x86_64-w64-mingw32-gcc
          fyne package -os  ${{ matrix.goos }} -icon icon.png
          ls ./
          mkdir build
          mv myapp.exe ./build/Mi Router BE5000 (RD18) Get SSH Tool.exe

      - uses: ncipollo/release-action@v1
        with:
          artifacts: "./build"